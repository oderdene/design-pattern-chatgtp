“Æ–Ω—ç—Ö—ç—ç—Ä ”©–Ω–¥”©—Ä —Ç“Ø–≤—à–Ω–∏–π, –≥“Ø–Ω–∑–≥–∏–π –æ–π–ª–≥–æ–ª—Ç —à–∞–∞—Ä–¥–∞—Ö –∞—Å—É—É–ª—Ç—É—É–¥ –±–∞–π–Ω–∞! –≠–¥–≥—ç—ç—Ä–∏–π–≥ **–ø—Ä–æ–≥—Ä–∞–º–º —Ö–∞–Ω–≥–∞–º–∂–∏–π–Ω –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã–Ω —Ç–∞–ª–∞–∞—Å** —Ç–∞–π–ª–±–∞—Ä–ª–∞—è. Flyweight –∑–∞–≥–≤–∞—Ä—ã–Ω –Ω”©–ª”©”©, —ç—Ä—Å–¥—ç–ª, –¥–∞–≤—É—É —Ç–∞–ª, –æ–ª–æ–Ω-thread –æ—Ä—á–∏–Ω–¥ —Ö—ç—Ä—Ö—ç–Ω –∞–∂–∏–ª–ª–∞–¥–∞–≥, —à–∏–Ω—ç —à–∞–∞—Ä–¥–ª–∞–≥–∞–¥ —Ö—ç—Ä—Ö—ç–Ω —É—è–ª–¥–¥–∞–≥ –≥—ç—ç–¥ –±“Ø—Ö –∞—Å—É—É–¥–ª—ã–≥ –¥–æ—Ä –Ω–∞—Ä–∏–π–≤—á–ª–∞–Ω —Ç–∞–π–ª–±–∞—Ä–ª–∞—Å–∞–Ω –±–∞–π–≥–∞–∞:

---

## üîπ **16. Flyweight –∑–∞–≥–≤–∞—Ä –∫–æ–¥—ã–Ω —É–Ω—à–∏–≥–¥–∞—Ö –±–∞–π–¥–∞–ª, –∑–∞—Å–≤–∞—Ä–ª–∞—Ö –±–æ–ª–æ–º–∂, —Ç—É—Ä—à–∏—Ö–∞–¥ —Ö—ç—Ä—Ö—ç–Ω –Ω”©–ª”©”©–ª–¥”©–≥ –≤—ç?**

| “Æ–∑“Ø“Ø–ª—ç–ª—Ç          | –ù”©–ª”©”©–ª”©–ª                                                                                       |
|-------------------|------------------------------------------------------------------------------------------------|
| ‚úÖ **Readability (—É–Ω—à–∏–≥–¥–∞—Ö –±–∞–π–¥–∞–ª)**  | –•—É–≤–∞–∞–ª—Ü—Å–∞–Ω –æ–±—å–µ–∫—Ç—É—É–¥ –Ω—å –∫–æ–¥—ã–Ω **—à—É—É–¥ –æ–π–ª–≥–æ–ª—Ç–æ–¥ —Ç”©–≤”©–≥—Ç—ç–π** –±–∞–π–∂ –±–æ–ª–Ω–æ. –¢”©–ª”©–≤ –≥–∞–¥–Ω–∞–∞—Å –∏—Ä–¥—ç–≥ —Ç—É–ª –æ–π–ª–≥–æ—Ö–æ–¥ –∏–ª“Ø“Ø —Ö“Ø—á–∏–Ω —á–∞—Ä–º–∞–π–ª—Ç —à–∞–∞—Ä–¥–¥–∞–≥. |
| ‚úÖ **Maintainability (–∑–∞—Å–≤–∞—Ä–ª–∞—Ö –±–æ–ª–æ–º–∂)** | Intrinsic/extrinsic state-–∏–π–≥ –∑”©–≤ –∑–æ—Ö–∏—Ü—É—É–ª—Å–∞–Ω –±–æ–ª **”©–Ω–¥”©—Ä –∑–∞—Å–≤–∞—Ä–ª–∞—Ö —á–∞–¥–≤–∞—Ä—Ç–∞–π**. –ì—ç—Ö–¥—ç—ç –∞–ª–¥–∞–∞ –≥–∞—Ä–≤–∞–ª trace —Ö–∏–π—Ö —Ö—ç—Ü“Ø“Ø.              |
| ‚úÖ **Testability (—Ç—É—Ä—à–∏—Ö –±–æ–ª–æ–º–∂)**   | Unit test —Ö–∏–π—Ö—ç–¥ **extrinsic state-–≥ —Ç—É—Å–∞–¥ –Ω—å ”©–≥–¥”©–≥ –Ω—å –¥–∞–≤—É—É** –±–æ–ª–æ–≤—á shared –æ–±—å–µ–∫—Ç–æ–æ—Å —à–∞–ª—Ç–≥–∞–∞–ª—Å–∞–Ω –∞–ª–¥–∞–∞–≥ —Ç—É—Å–≥–∞–∞—Ä–ª–∞—Ö —Ö—ç—Ü“Ø“Ø –±–∞–π–∂ –±–æ–ª–Ω–æ. |

> üîé **–¢–æ–≤—á –¥“Ø–≥–Ω—ç–ª—Ç**: Code –Ω—å **–º–æ–¥—É–ª—å—á–ª–∞–≥–¥—Å–∞–Ω** –±–æ–ª–æ–≤—á, –æ–π–ª–≥–æ–º–∂ –±–æ–ª–æ–Ω —Ç–µ—Å—Ç–ª—ç—Ö —Ç–∞–ª –¥—ç—ç—Ä –Ω—ç–º—ç–ª—Ç –∑–æ—Ö–∏–æ–Ω –±–∞–π–≥—É—É–ª–∞–ª—Ç —à–∞–∞—Ä–¥–¥–∞–≥.

---

## üîπ **17. Flyweight –∑–∞–≥–≤–∞—Ä –≥“Ø–π—Ü—ç—Ç–≥—ç–ª–¥ (performance) —è–º–∞—Ä –Ω”©–ª”©”© “Ø–∑“Ø“Ø–ª–¥—ç–≥ –≤—ç?**

### ‚úÖ **–î–∞–≤—É—É —Ç–∞–ª (Positive impact):**
- **–°–∞–Ω–∞—Ö –æ–π —Ö—ç–º–Ω—ç–Ω—ç** ‚Äî —Å–∞—è —Å–∞—è –∏–∂–∏–ª —Ç”©—Ä–ª–∏–π–Ω –æ–±—å–µ–∫—Ç “Ø“Ø—Å–≥—ç—Ö–≥“Ø–π.
- **CPU –∫—ç—à–∏–π–Ω –¥–∞–≤—É—É —Ç–∞–ª** ‚Äî —Ö—É–≤–∞–∞–ª—Ü—Å–∞–Ω –æ–±—å–µ–∫—Ç –Ω—å CPU cache-—Ç –±–∞–≥—Ç–¥–∞–≥ —Ç—É–ª —Ö—É—Ä–¥–∞–Ω —É–Ω—à–∏–≥–¥–¥–∞–≥.

### ‚ùå **Overhead (–°—É–ª —Ç–∞–ª / –∑–∞—Ä–¥–∞–ª):**
- **Factory lookup –∑–∞—Ä–¥–∞–ª** ‚Äî FlyweightFactory-–∏–π–Ω map/dictionary lookup –≥“Ø–π—Ü—ç—Ç–≥—ç–ª–∏–π–≥ –±–∞–≥–∞ –∑—ç—Ä—ç–≥ –±—É—É—Ä—É—É–ª–∂ –±–æ–ª–Ω–æ.
- **Extrinsic state-–≥ “Ø—Ä–≥—ç–ª–∂ –≥–∞–¥–Ω–∞–∞—Å –æ—Ä—É—É–ª–∞—Ö —à–∞–∞—Ä–¥–ª–∞–≥–∞—Ç–∞–π** ‚Äî —ç–Ω—ç –Ω—å –∑–∞—Ä–∏–º —Ç–æ—Ö–∏–æ–ª–¥–æ–ª–¥ –ª–æ–≥–∏–∫ —Ç”©–≤”©–≥—Ç—ç–π –±–æ–ª–≥–æ–¥–æ–≥.
- **Thread-safety lock** (—Ö—ç—Ä—ç–≤ –æ–ª–æ–Ω-thread –æ—Ä—á–∏–Ω–¥ –±–∞–π–≤–∞–ª) performance –±—É—É—Ä—É—É–ª–∞—Ö —ç—Ä—Å–¥—ç–ª—Ç—ç–π.

> üîß **–¢–æ—Ö–∏—Ä—Å–æ–Ω —Ö—ç—Ä—ç–≥–ª—ç—ç–Ω–¥ –±–æ–ª performance ”©–Ω–¥”©—Ä—Å–¥”©–≥**, —Ö–∞—Ä–∏–Ω –±—É—Ä—É—É —Ö—ç—Ä—ç–≥–ª—ç–≤—ç–ª –∏–ª“Ø“Ø overhead “Ø“Ø—Å–≥—ç–∂ —á –º–∞–≥–∞–¥–≥“Ø–π.

---

## üîπ **18. Flyweight –∑–∞–≥–≤–∞—Ä –æ–ª–æ–Ω-thread (concurrent) –æ—Ä—á–∏–Ω–¥ —Ö—ç—Ä—Ö—ç–Ω –∞–∂–∏–ª–ª–∞–¥–∞–≥ –≤—ç?**

### ‚úÖ **–î–∞–≤—É—É —Ç–∞–ª**:
- –•—ç—Ä—ç–≤ Flyweight-—É—É–¥ **immutable** (”©”©—Ä—á–ª”©–≥–¥–¥”©–≥–≥“Ø–π) –±–æ–ª:
  - –≠–¥–≥—ç—ç—Ä–∏–π–≥ –æ–ª–æ–Ω-thread —Ö—É–≤–∞–∞–ª—Ü–∞–∂ —Ö—ç—Ä—ç–≥–ª—ç–∂ –±–æ–ª–Ω–æ.
  - Thread-safe –±–∞–π–¥–ª–∞–∞—Ä –∞–∂–∏–ª–ª–∞–Ω–∞.

### ‚ùå **–ë–æ–ª–∑–æ—à–≥“Ø–π —ç—Ä—Å–¥—ç–ª**:
- **FlyweightFactory** –¥–æ—Ç–æ—Ä caching —Ö–∏–π–∂ –±–∞–π–≥–∞–∞ –±–æ–ª:
  - Dictionary/map-–∏–π–≥ **thread-safe** –±–∞–π–¥–ª–∞–∞—Ä –∑–æ—Ö–∏–æ–Ω –±–∞–π–≥—É—É–ª–∞—Ö —à–∞–∞—Ä–¥–ª–∞–≥–∞—Ç–∞–π.
  - Java –¥—ç—ç—Ä `ConcurrentHashMap`, Python –¥—ç—ç—Ä `threading.Lock`, C++ –¥—ç—ç—Ä `mutex` –∞—à–∏–≥–ª–∞–Ω–∞.

### üõ† –ñ–∏—à—ç—ç:

```python
import threading

lock = threading.Lock()

class SafeTreeFactory:
    _tree_types = {}

    @classmethod
    def get_tree_type(cls, name, color, texture):
        with lock:  # Critical section
            key = (name, color, texture)
            if key not in cls._tree_types:
                cls._tree_types[key] = TreeType(name, color, texture)
            return cls._tree_types[key]
```

---

## üîπ **19. –®–∞–∞—Ä–¥–ª–∞–≥—É—É–¥ ”©”©—Ä—á–ª”©–≥–¥–≤”©–ª Flyweight –∑–∞–≥–≤–∞—Ä —Ö—ç—Ä—Ö—ç–Ω —Ö—É–≤—å—Å–¥–∞–≥ –≤—ç?**

### üîÑ **–¢–æ—Ö–∏—Ä–æ–º–∂—Ç–æ–π —Ö—É–≤—å—Å–∞—Ö –±–∞–π–¥–∞–ª (Flexible evolution):**
- –•—ç—Ä—ç–≤ —à–∏–Ω—ç —à–∞–∞—Ä–¥–ª–∞–≥–∞ Intrinsic/Extrinsic state –Ω—ç–º—ç—Ö—ç–¥ —Ö–∞–º–∞–∞—Ä–≤–∞–ª:
  - –ó–∞–≥–≤–∞—Ä—ã–≥ **”©—Ä–≥”©—Ç–≥”©—Ö”©–¥ –∞–º–∞—Ä—Ö–∞–Ω**.
  - –ñ–∏—à—ç—ç: —à–∏–Ω—ç —Ç”©—Ä–ª–∏–π–Ω –º–æ–¥–Ω—ã ”©–Ω–≥”©, —Ç–µ–∫—Å—Ç—É—Ä –Ω—ç–º—ç—Ö.

### ‚ùó **–•—ç—Ü“Ø“Ø —Ö—É–≤—å—Å–∞—Ö –±–∞–π–¥–∞–ª (Risky evolution):**
- –•—ç—Ä—ç–≤ –æ–±—å–µ–∫—Ç –±“Ø—Ä–∏–π–Ω —Ç”©–ª”©–≤ state **–¥–∏–Ω–∞–º–∏–∫ ”©”©—Ä—á–ª”©–≥–¥”©—Ö —à–∞–∞—Ä–¥–ª–∞–≥–∞—Ç–∞–π –±–æ–ª**:
  - Flyweight —Ö–∞–Ω–¥–ª–∞–≥–∞ –Ω—å —Ç–æ—Ö–∏—Ä–æ—Ö–æ–æ –±–æ–ª—å–∂ –±–æ–ª–Ω–æ.
  - –•—É–≤–∞–∞–ª—Ü—Å–∞–Ω –æ–±—å–µ–∫—Ç–∏–π–≥ ”©”©—Ä—á–ª”©—Ö “Ø–µ–¥ **–±—É—Å–∞–¥ client-–¥ –Ω”©–ª”©”©–ª”©—Ö —ç—Ä—Å–¥—ç–ª**—Ç—ç–π.
  
> üß† –®–∞–∞—Ä–¥–ª–∞–≥–∞ ”©”©—Ä—á–ª”©–≥–¥”©—Ö “Ø–µ–¥ —Ö–∞–º–≥–∏–π–Ω —á—É—Ö–∞–ª –∑“Ø–π–ª –±–æ–ª:
> **‚Äú–•—É–≤–∞–∞–ª—Ü–∞–∂ –±–æ–ª–æ—Ö ”©–≥”©–≥–¥”©–ª‚Äù VS ‚Äú–ó”©–≤—Ö”©–Ω —Ç—É—Ö–∞–π–Ω –æ–±—å–µ–∫—Ç–æ–¥ —Ö–∞–º–∞–∞—Ä–∞—Ö ”©–≥”©–≥–¥”©–ª‚Äù-–∏–π–≥ —è–ª–≥–∞–∂ —Å–∞–ª–≥–∞—Ö**

---

## üîπ **20. Flyweight –∑–∞–≥–≤–∞—Ä —Ö—ç—Ä—ç–≥–ª—ç—Ö—ç–¥ —Ö–∞–º–≥–∏–π–Ω —Ç“Ø–≥—ç—ç–º—ç–ª –∞–ª–¥–∞–∞ / –∞–Ω—Ö–∞–∞—Ä–∞—Ö –∑“Ø–π–ª—Å?**

### ‚ö†Ô∏è **–¢“Ø–≥—ç—ç–º—ç–ª –∞–ª–¥–∞–∞ / pitfalls:**

1. ‚ùå **Intrinisic –±–∞ Extrinsic —Ç”©–ª–≤–∏–π–≥ —è–ª–≥–∞—Ö–≥“Ø–π –±–∞–π—Ö**
   - –≠–Ω—ç –Ω—å –ª–æ–≥–∏–∫–∏–π–≥ –±—É–¥–ª–∏–∞–Ω—Ç—É—É–ª–∂, –±–∞–≥–∏–π–Ω –≥–∏—à“Ø“Ø–¥ –æ–π–ª–≥–æ—Ö–æ–¥ —Ö—ç—Ü“Ø“Ø –±–æ–ª–≥–æ–¥–æ–≥.

2. ‚ùå **–•—É–≤–∞–∞–ª—Ü—Å–∞–Ω –æ–±—å–µ–∫—Ç–∏–π–≥ ”©”©—Ä—á–ª”©—Ö**
   - –≠–Ω—ç –Ω—å –±—É—Å–∞–¥ —Ö—ç—Ä—ç–≥–ª—ç–≥—á–¥—ç–¥ –Ω”©–ª”©”©–ª–∂, **unexpected behavior** –≥–∞—Ä–Ω–∞.

3. ‚ùå **Thread-safety-–≥ “Ø–ª —Ç–æ–æ—Ö**
   - Factory –¥–æ—Ç–æ—Ä –Ω—ç–≥—ç–Ω –∑—ç—Ä—ç–≥ —Ö—ç–¥ —Ö—ç–¥—ç–Ω thread —Ö–∞–Ω–¥–∞—Ö “Ø–µ–¥ **data race** “Ø“Ø—Å–Ω—ç.

4. ‚ùå **Flyweight-–∏–π–≥ —Ö—ç—Ç –∏—Ö —Ö—ç—Ä—ç–≥–ª—ç–∂, –∑–æ—Ö–∏–æ–Ω –±–∞–π–≥—É—É–ª–∞–ª—Ç—ã–≥ —Ç”©–≤”©–≥—Ç—ç–π –±–æ–ª–≥–æ—Ö**
   - Performance –∞—à–∏–≥ –æ–ª–∂ –∞–≤–∞—Ö–≥“Ø–π —Ö—ç—Ä–Ω—ç—ç –∫–æ–¥—ã–Ω —Ç”©–≤”©–≥—à–∏–ª –Ω—ç–º—ç–≥–¥–¥—ç–≥.

5. ‚ùå **Too much indirection**
   - –û–±—å–µ–∫—Ç—ã–Ω —Ç”©–ª–≤–∏–π–≥ –¥–∞–Ω–¥–∞–∞ –≥–∞–¥–Ω–∞–∞—Å ”©–≥—á –±–∞–π—Ö —à–∞–∞—Ä–¥–ª–∞–≥–∞ –Ω—å **code-—ã–≥ –∏–ª —Ç–æ–¥ –±—É—Å –±–æ–ª–≥–æ–Ω–æ**.

---

### ‚úÖ **–ó”©–≤ –ø—Ä–∞–∫—Ç–∏–∫:**
- –•—É–≤–∞–∞–ª—Ü–∞–∂ –±–æ–ª–æ—Ö ”©–≥”©–≥–¥–ª–∏–π–≥ **immutable** –±–∞–π–ª–≥–∞—Ö.
- Factory-–≥ thread-safe –±–æ–ª–≥–æ—Ö.
- –ö–æ–¥—ã–Ω —É–Ω—à–∏–≥–¥–∞—Ö –±–∞–π–¥–∞–ª–¥ –∞–Ω—Ö–∞–∞—Ä—á, –Ω—ç—Ä—à–∏–ª, abstraction-–∏–π–≥ —Å–∞–π–Ω –±–∞—Ä–∏–º—Ç–∂—É—É–ª–∞—Ö.

---

–•—ç—Ä–≤—ç—ç —Ö“Ø—Å–≤—ç–ª –±–∏ –±“Ø—Ö Flyweight –æ–π–ª–≥–æ–ª—Ç—ã–≥ **–Ω—ç–≥ –∑—É—Ä–∞–≥** —ç—Å–≤—ç–ª **PDF format** –±–æ–ª–≥–æ–Ω —Ü—ç–≥—Ü—ç–ª–∂, —Ö—É—Ä–∞–∞–Ω–≥—É–π–ª–∞—Ö –±–æ–ª–æ–º–∂—Ç–æ–π. –≠—Å–≤—ç–ª —è–º–∞—Ä –Ω—ç–≥ **framework –¥–æ—Ç–æ—Ä** —ç–Ω—ç –∑–∞–≥–≤–∞—Ä—ã–≥ –∞—à–∏–≥–ª–∞—Ö –∫–µ–π—Å—ç—ç—Ä –∏–ª“Ø“Ø –≥“Ø–Ω –∞–≤—á “Ø–∑—ç—Ö —á –±–æ–ª–Ω–æ. –•—ç–ª—ç—ç–¥ –ª ”©–≥! üòä